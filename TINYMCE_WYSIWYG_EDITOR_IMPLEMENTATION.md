# âœ… Ã‰diteur WYSIWYG avec TinyMCE et WebView2

## ğŸ“‹ Vue d'ensemble

L'onglet **Challenge Mailing** dispose maintenant d'un **Ã©diteur WYSIWYG professionnel** (What You See Is What You Get) basÃ© sur **TinyMCE**, l'un des Ã©diteurs HTML les plus populaires au monde.

### ğŸ¯ Ce qui a Ã©tÃ© implÃ©mentÃ©

- âœ… **Ã‰diteur riche type Word** - Ã‰ditez visuellement sans toucher au HTML
- âœ… **TinyMCE intÃ©grÃ©** - Ã‰diteur JavaScript de qualitÃ© professionnelle
- âœ… **WebView2** - Moteur Microsoft Edge pour le rendu
- âœ… **Synchronisation automatique** - Le HTML est gÃ©nÃ©rÃ© automatiquement
- âœ… **Barre d'outils complÃ¨te** - Tous les outils de formatage nÃ©cessaires

---

## ğŸ¨ Interface utilisateur

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Challenge Mailing                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  [Generate Email Template] â† GÃ©nÃ¨re le HTML                â”‚
â”‚                                                             â”‚
â”‚  Subject: [________________________________________]        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âœï¸ Email Editor (WYSIWYG)                            â”‚ â”‚
â”‚  â”‚ [ğŸ”„ Load Template] [ğŸ’¾ Get HTML]                     â”‚ â”‚
â”‚  â”‚ â„¹ï¸ Edit your email like in Word                      â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ [B] [I] [U] [Colors] [Lists] [Tables] [Links]       â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  ğŸƒ Challenge 2025                                    â”‚ â”‚
â”‚  â”‚  Mise Ã  jour du Challenge - 09 fÃ©vrier 2025          â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  ğŸ“… Prochaine Course                                  â”‚ â”‚
â”‚  â”‚  Run in LiÃ¨ge - 15/02/2025                           â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  ğŸ† Derniers RÃ©sultats                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚ â”‚
â”‚  â”‚  â”‚Pos â”‚ Nom          â”‚ Temps  â”‚ Points â”‚            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚ â”‚
â”‚  â”‚  â”‚ 1  â”‚ Jean DUPONT  â”‚ 45:23  â”‚  100   â”‚  â† Ã‰ditableâ”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  Test Email: [test@example.com] [Send Test]               â”‚
â”‚  [Send to All Challengers]                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Guide d'utilisation

### 1ï¸âƒ£ GÃ©nÃ©rer le template initial

1. **SÃ©lectionnez un challenge** dans la liste dÃ©roulante
2. **Cliquez sur "Generate Email Template"**
3. Le HTML est gÃ©nÃ©rÃ© automatiquement
4. **Cliquez sur "ğŸ”„ Load Template"**
5. L'email s'affiche dans l'Ã©diteur WYSIWYG

### 2ï¸âƒ£ Ã‰diter l'email visuellement

Vous pouvez maintenant Ã©diter comme dans **Microsoft Word** :

#### ğŸ“ Texte et mise en forme

- **Gras** : SÃ©lectionnez le texte et cliquez sur [B]
- **Italique** : Cliquez sur [I]
- **SoulignÃ©** : Cliquez sur [U]
- **BarrÃ©** : Utilisez le bouton de barre
- **Couleurs** : Changez la couleur du texte ou du fond

#### ğŸ“‹ Listes

- **Liste Ã  puces** : Cliquez sur l'icÃ´ne liste
- **Liste numÃ©rotÃ©e** : Cliquez sur l'icÃ´ne numÃ©ros
- **Indentation** : Augmenter/diminuer avec les boutons

#### ğŸ”— Liens et images

- **InsÃ©rer un lien** : SÃ©lectionnez le texte â†’ icÃ´ne lien â†’ entrez l'URL
- **InsÃ©rer une image** : icÃ´ne image â†’ entrez l'URL de l'image

#### ğŸ“Š Tableaux

- **CrÃ©er un tableau** : Menu "Table" â†’ "Insert table"
- **Ajouter des lignes** : Clic droit â†’ "Row" â†’ "Insert row after/before"
- **Ajouter des colonnes** : Clic droit â†’ "Column" â†’ "Insert column..."
- **Fusionner des cellules** : SÃ©lectionner â†’ Clic droit â†’ "Cell" â†’ "Merge cells"
- **Supprimer** : SÃ©lectionner â†’ Clic droit â†’ "Delete row/column/table"

#### ğŸ¨ Alignement

- **Gauche/Centre/Droite/JustifiÃ©** : Boutons d'alignement

### 3ï¸âƒ£ Sauvegarder les modifications

**Option A : Automatique**
- Les modifications sont sauvegardÃ©es automatiquement quand vous cliquez hors de l'Ã©diteur
- Ou quand vous changez de champ

**Option B : Manuel**
- Cliquez sur **"ğŸ’¾ Get HTML"**
- Le HTML est rÃ©cupÃ©rÃ© et sauvegardÃ© dans le ViewModel

### 4ï¸âƒ£ Envoyer l'email

1. **Test** : Envoyez d'abord un email de test
2. **VÃ©rifiez** : Ouvrez l'email reÃ§u
3. **Envoi massif** : Cliquez sur "Send to All Challengers"

---

## ğŸ› ï¸ Barre d'outils TinyMCE

### Outils disponibles

| IcÃ´ne/Bouton | Fonction | Raccourci |
|--------------|----------|-----------|
| **Undo/Redo** | Annuler/Refaire | Ctrl+Z / Ctrl+Y |
| **Blocks** | Paragraphe, Titres (H1-H6) | - |
| **B** | Gras | Ctrl+B |
| **I** | Italique | Ctrl+I |
| **U** | SoulignÃ© | Ctrl+U |
| **S** | BarrÃ© | - |
| **Align** | Alignement gauche/centre/droite/justifiÃ© | - |
| **Bullets** | Liste Ã  puces | - |
| **Numbers** | Liste numÃ©rotÃ©e | - |
| **Indent** | Augmenter/diminuer l'indentation | - |
| **Colors** | Couleur du texte et du fond | - |
| **Table** | InsÃ©rer et gÃ©rer des tableaux | - |
| **Link** | InsÃ©rer un lien hypertexte | Ctrl+K |
| **Image** | InsÃ©rer une image | - |
| **Remove Format** | Supprimer toute la mise en forme | - |
| **Code** | Voir/Ã©diter le code HTML source | - |
| **Help** | Aide TinyMCE | - |

---

## ğŸ’¡ Exemples de modifications

### Exemple 1 : Modifier un titre

**Avant:**
```
ğŸƒ Challenge 2025
```

**Comment faire:**
1. Double-cliquez sur "Challenge 2025"
2. Tapez le nouveau texte : "Super Challenge 2025"
3. Changez la couleur si vous voulez (bouton couleur)

**RÃ©sultat:**
```
ğŸƒ Super Challenge 2025
```

### Exemple 2 : Ajouter une ligne dans un tableau

**Comment faire:**
1. Cliquez dans une cellule du tableau
2. Clic droit â†’ "Row" â†’ "Insert row after"
3. Remplissez les cellules

**Avant:**
| Pos | Nom | Temps | Points |
|-----|-----|-------|--------|
| 1 | Jean DUPONT | 45:23 | 100 |
| 2 | Marie MARTIN | 46:12 | 95 |

**AprÃ¨s:**
| Pos | Nom | Temps | Points |
|-----|-----|-------|--------|
| 1 | Jean DUPONT | 45:23 | 100 |
| 2 | Marie MARTIN | 46:12 | 95 |
| 3 | Pierre BERNARD | 47:05 | 90 |

### Exemple 3 : Changer la couleur d'un en-tÃªte de tableau

**Comment faire:**
1. SÃ©lectionnez la ligne d'en-tÃªte
2. Cliquez sur le bouton "Background color"
3. Choisissez une nouvelle couleur (ex: bleu)

### Exemple 4 : Ajouter un message important

**Comment faire:**
1. Placez le curseur oÃ¹ vous voulez insÃ©rer le message
2. Tapez votre texte
3. SÃ©lectionnez le texte
4. Changez la couleur de fond (ex: jaune clair)
5. Changez la couleur du texte (ex: rouge)

**RÃ©sultat:**
```
âš¡ IMPORTANT: Inscriptions ouvertes jusqu'au 28 fÃ©vrier !
```

---

## âš™ï¸ FonctionnalitÃ©s avancÃ©es

### Mode Code Source

Si vous devez accÃ©der au HTML brut :
1. Cliquez sur le bouton **"Code"** dans la barre d'outils
2. Ã‰ditez le HTML directement
3. Cliquez sur **"Save"**
4. L'Ã©diteur WYSIWYG se met Ã  jour

### Copier-coller depuis Word

Vous pouvez copier du contenu depuis Microsoft Word :
1. **Copiez** le contenu dans Word (Ctrl+C)
2. **Collez** dans l'Ã©diteur TinyMCE (Ctrl+V)
3. TinyMCE nettoie automatiquement le HTML

âš ï¸ **Note** : Certains styles complexes de Word peuvent Ãªtre simplifiÃ©s.

### Rechercher et remplacer

1. Menu **"Edit"** â†’ **"Find and replace"**
2. Entrez le texte Ã  rechercher
3. Entrez le texte de remplacement
4. Cliquez sur "Replace" ou "Replace all"

---

## ğŸ”§ Architecture technique

### Composants utilisÃ©s

1. **WebView2** (`Microsoft.Web.WebView2`)
   - Moteur Microsoft Edge Chromium
   - Rendu HTML5/CSS3/JavaScript moderne
   - Communication bidirectionnelle C# â†” JavaScript

2. **TinyMCE 6** (CDN)
   - Ã‰diteur WYSIWYG JavaScript
   - Open source et gratuit
   - Plugins : tables, listes, liens, images, code, etc.

3. **Communication**
   - C# â†’ JavaScript : `ExecuteScriptAsync()`
   - JavaScript â†’ C# : `WebMessageReceived` event

### Flux de donnÃ©es

```
1. User clicks "Generate Template"
   â†“
2. ViewModel generates HTML
   â†“
3. C# dÃ©tecte le changement (PropertyChanged)
   â†“
4. C# envoie le HTML Ã  TinyMCE via ExecuteScriptAsync()
   â†“
5. TinyMCE affiche l'email Ã©ditable
   â†“
6. User Ã©dite dans TinyMCE
   â†“
7. TinyMCE envoie le HTML modifiÃ© Ã  C# (WebMessageReceived)
   â†“
8. C# met Ã  jour le ViewModel
   â†“
9. Email prÃªt Ã  Ãªtre envoyÃ©
```

---

## ğŸ“¦ PrÃ©requis

### Microsoft Edge WebView2 Runtime

WebView2 nÃ©cessite **Microsoft Edge WebView2 Runtime**:

âœ… **GÃ©nÃ©ralement dÃ©jÃ  installÃ©** sur Windows 10/11
âœ… **TÃ©lÃ©chargement automatique** si manquant
âœ… **Taille** : ~150 MB

**Si l'Ã©diteur ne se charge pas:**
1. TÃ©lÃ©chargez manuellement : https://developer.microsoft.com/microsoft-edge/webview2/
2. Installez "Evergreen Standalone Installer"
3. RedÃ©marrez l'application

---

## ğŸ› DÃ©pannage

### ProblÃ¨me : L'Ã©diteur ne s'affiche pas

**Solutions:**
1. VÃ©rifiez que Edge WebView2 Runtime est installÃ©
2. VÃ©rifiez le message d'erreur dans la MessageBox
3. TÃ©lÃ©chargez et installez WebView2 Runtime
4. RedÃ©marrez l'application

### ProblÃ¨me : Le template ne se charge pas

**Solutions:**
1. Cliquez sur "Generate Email Template"
2. Attendez que le HTML soit gÃ©nÃ©rÃ©
3. Cliquez sur **"ğŸ”„ Load Template"**
4. VÃ©rifiez que l'Ã©diteur est bien initialisÃ©

### ProblÃ¨me : Les modifications ne sont pas sauvegardÃ©es

**Solutions:**
1. Cliquez hors de l'Ã©diteur (sauvegarde automatique)
2. Ou cliquez sur **"ğŸ’¾ Get HTML"** (sauvegarde manuelle)
3. VÃ©rifiez que le HTML dans le ViewModel est mis Ã  jour

### ProblÃ¨me : TinyMCE affiche "Failed to load"

**Solutions:**
1. VÃ©rifiez votre connexion Internet (TinyMCE est chargÃ© depuis le CDN)
2. Si pas d'Internet, TinyMCE ne se chargera pas
3. Alternative : TÃ©lÃ©charger TinyMCE localement (voir section Alternative)

---

## ğŸŒ Alternative sans Internet (TinyMCE local)

Si vous n'avez pas accÃ¨s Ã  Internet, vous pouvez tÃ©lÃ©charger TinyMCE localement :

### Ã‰tapes

1. **TÃ©lÃ©charger TinyMCE**
   - https://www.tiny.cloud/get-tiny/self-hosted/
   - TÃ©lÃ©chargez "Community Edition (Free)"

2. **Extraire dans le projet**
   - CrÃ©ez le dossier `NameParser.UI\Resources\tinymce\`
   - Extrayez les fichiers dedans

3. **Modifier TinyMCEEditor.html**
   ```html
   <!-- Au lieu de CDN -->
   <script src="https://cdn.tiny.cloud/1/.../tinymce.min.js"></script>
   
   <!-- Utilisez le fichier local -->
   <script src="tinymce/tinymce.min.js"></script>
   ```

4. **Mettre Ã  jour le .csproj**
   ```xml
   <None Update="Resources\tinymce\**\*">
     <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
   </None>
   ```

---

## âœ… Avantages de cette solution

### ğŸ¯ Pour l'utilisateur

âœ… **Ã‰dition intuitive** - Comme dans Word, aucune connaissance HTML requise
âœ… **WYSIWYG** - Ce que vous voyez est ce qui sera envoyÃ©
âœ… **Tous les outils** - Formatage complet (gras, couleurs, tableaux, etc.)
âœ… **Erreurs rÃ©duites** - Pas de risque de casser le HTML
âœ… **Copier-coller** - Depuis Word ou d'autres sources
âœ… **Professionnel** - Ã‰diteur de qualitÃ© industrielle

### ğŸ”§ Pour le dÃ©veloppeur

âœ… **TinyMCE** - Ã‰diteur open source populaire et bien maintenu
âœ… **WebView2** - Moteur moderne (Edge Chromium)
âœ… **Synchronisation** - HTML automatiquement gÃ©nÃ©rÃ© et sauvegardÃ©
âœ… **Extensible** - Facile d'ajouter des plugins TinyMCE
âœ… **Pas de conversion** - TinyMCE gÃ¨re le HTML nativement

---

## ğŸš€ AmÃ©liorations futures possibles

### 1. Templates personnalisÃ©s
- [ ] Sauvegarder des templates d'emails
- [ ] Charger des templates prÃ©dÃ©finis
- [ ] Galerie de templates

### 2. Plugins additionnels TinyMCE
- [ ] VÃ©rificateur orthographique
- [ ] Insertion d'Ã©mojis avancÃ©e
- [ ] Galerie d'images
- [ ] Templates de tableaux

### 3. PrÃ©visualisation multi-clients
- [ ] AperÃ§u Gmail
- [ ] AperÃ§u Outlook
- [ ] AperÃ§u mobile

### 4. Version locale de TinyMCE
- [ ] TÃ©lÃ©charger TinyMCE localement
- [ ] Fonctionnement sans Internet

---

## ğŸ“š Ressources

- **TinyMCE Documentation** : https://www.tiny.cloud/docs/
- **WebView2 Documentation** : https://learn.microsoft.com/microsoft-edge/webview2/
- **TinyMCE Playground** : https://www.tiny.cloud/tinymce-playground/

---

**Date de mise en Å“uvre** : 2025-02-09  
**Version** : 3.0 - Ã‰diteur WYSIWYG avec TinyMCE + WebView2  
**Build** : âœ… RÃ©ussi  
**PrÃ©requis** : Edge WebView2 Runtime (gÃ©nÃ©ralement dÃ©jÃ  installÃ©)
